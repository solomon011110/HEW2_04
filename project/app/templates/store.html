{% extends "layout.html" %}

{% block title %}
{{ product.name }}の詳細
{% endblock %}

{% block content %}
<div class="product">
    <div class="flex-box">
        <div class="slide-wrapper">
            <div id="slide" class="slide">
                {% for image in image_url %}
                <div>
                    <img src="{{ image }}" alt="{{ product.name }}">
                </div>
                {% endfor %}
            </div>
            <span id="prev" class="prev"></span>
            <span id="next" class="next"></span>
            <ul class="indicator" id="indicator">
                {% for image in image_url %}
                <li class="list"></li>
                {% endfor %}
            </ul>
        </div>
        <div class="text-box">
            <h3>{{ product.name }}</h3>
            <div class="review flex-box">
                <div class="star">
                    <p>{{review_avg_star}} {{"★"*int_review_avg_star}}{{"☆"*(5-int_review_avg_star)}}</p>
                </div>
                <p class="howmanyreviews">{{sum_review}}件</p>
            </div>
            <h4>\{{ product.sale_price }} <span class="tax">税込</span></h4>
            <form action="{{ url_for('main.add_to_cart', product_id=product.id) }}" method="POST">
                <button type="submit" class="btn">🛒 カートに追加</button>
            </form>
            <div class="explanation">
              <h5>商品説明</h5>
              <p>{{ product.defect_reason }}</p>
          </div>
      </div>
  </div>
  <div class="recommend flex-box">
    <a href="" class="item-box">
      <div class="image-box">
          <img src="./images/egg.jpg">
      </div>
      <div class="text-box">
          <p class="name">たまご</p>
          <p class="price">\10,000 <span class="tax">税込</span></p>
      </div>
      <div class="review flex-box">
          <div class="star">
              <p>☆☆☆☆☆</p>
          </div>
          <p class="howmanyreviews">100件</p>
      </div>
      <div class="cart flex-box">
          <p>詳しく見る</p>
      </div>
    </a>
    <a href="" class="item-box">
      <div class="image-box">
          <img src="./images/egg.jpg">
      </div>
      <div class="text-box">
          <p class="name">たまご</p>
          <p class="price">\10,000 <span class="tax">税込</span></p>
      </div>
      <div class="review flex-box">
          <div class="star">
              <p>☆☆☆☆☆</p>
          </div>
          <p class="howmanyreviews">100件</p>
      </div>
      <div class="cart flex-box">
          <p>詳しく見る</p>
      </div>
    </a>
    <a href="" class="item-box">
      <div class="image-box">
          <img src="./images/egg.jpg">
      </div>
      <div class="text-box">
          <p class="name">たまご</p>
          <p class="price">\10,000 <span class="tax">税込</span></p>
      </div>
      <div class="review flex-box">
          <div class="star">
              <p>☆☆☆☆☆</p>
          </div>
          <p class="howmanyreviews">100件</p>
      </div>
      <div class="cart flex-box">
          <p>詳しく見る</p>
      </div>
    </a>
    <a href="" class="item-box">
      <div class="image-box">
          <img src="./images/egg.jpg">
      </div>
      <div class="text-box">
          <p class="name">たまご</p>
          <p class="price">\10,000 <span class="tax">税込</span></p>
      </div>
      <div class="review flex-box">
          <div class="star">
              <p>☆☆☆☆☆</p>
          </div>
          <p class="howmanyreviews">100件</p>
      </div>
      <div class="cart flex-box">
          <p>詳しく見る</p>
      </div>
    </a>
  </div>

  <div>
    <div>
      <form action="{{ url_for('main.add_review', product_id=product.id) }}" method="post">
        <label>評価<input type="number" name="star"></label>
        <label>タイトル<input type="text" name="title"></label>
        <label>本文<input type="text" name="describe"></label>
        <input type="submit" value="送信">
      </form>
    </div>
    
    <div>
      <h4>この商品のレビュー</h4>
      <h5>{{review_avg_star}} {{"★"*int_review_avg_star}}{{"☆"*(5-int_review_avg_star)}}({{sum_review}}件中)</h5>
      {% for review in reviews %}
      <p>{{review.title}} - 
        {{"★"*review.star}}{{"☆"*(5-review.star)}}</p>
      <p>{{review.describe}}</p>
      <br/>
      {% endfor %}
    </div>
  </div>
</div>

  <div style="margin-bottom: 200px;"><!-- 実装するときけしてください　footerできるまで下スぺ-ス作りたいだけ --></div>
        </div>
    </div>
</div>
<script>
  const slideContainer = document.querySelector('.slide');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const indicator = document.getElementById('indicator');
  const slides = document.querySelectorAll('.slide > div');
  const totalSlides = slides.length;
  const slideWidth = 100 / totalSlides;
  slideContainer.style.width = `${totalSlides * 100}%`;
  slides.forEach((slide) => {
    slide.style.width = `${slideWidth}%`;
  });
  let count = 0;
  let autoPlayInterval;
  function updateSlidePosition() {
    slideContainer.style.transform = `translateX(-${count * slideWidth}%)`;
  }
  function updateIndicatorColors() {
    const lists = document.querySelectorAll('.list');
    lists.forEach((list, i) => {
      list.style.backgroundColor = i === count % totalSlides ? '#000' : '#fff';
    });
  }
  function nextClick() {
    count++;
    if (count >= totalSlides) {
      count = 0;
    }
    updateSlidePosition();
    updateIndicatorColors();
  }
  function prevClick() {
    count--;
    if (count < 0) {
      count = totalSlides - 1;
    }
    updateSlidePosition();
    updateIndicatorColors();
  }
  next.addEventListener('click', () => {
    nextClick();
    resetAutoPlayInterval();
  });
  prev.addEventListener('click', () => {
    prevClick();
    resetAutoPlayInterval();
  });
  indicator.addEventListener('click', (event) => {
    if (event.target.classList.contains('list')) {
      const index = Array.from(indicator.children).indexOf(event.target);
      setActiveSlide(index);
    }
  });
  function setActiveSlide(index) {
    count = index;
    updateSlidePosition();
    updateIndicatorColors();
    resetAutoPlayInterval()
  }
  updateIndicatorColors();
</script>
{% endblock %}
